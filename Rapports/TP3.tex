\documentclass[12pt,a4paper]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage[frenchb]{babel}
\usepackage[left=1.5cm,right=1.5cm,top=2cm,bottom=2cm]{geometry}
\usepackage{listings}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{fancyhdr}
\author{Hamza ABBAD\\ Master Systèmes Informatiques Intelligents}
\title{\textbf{Rapport de TP ASGBD} \\ TP $n^{\circ}$3}
\lstdefinestyle{OracleSQL}{language=SQL,breaklines=true, frame=single, keywordstyle=\bfseries\color{Blue},
keywordstyle=[2]\color{Blue},stringstyle=\color{OliveGreen},extendedchars=false,sensitive=false,
commentstyle=\slshape\color{Gray},basicstyle=\small\ttfamily,
morekeywords={TABLESPACE,AUTOEXTEND,TEMPORARY,PRIVILEGES,DATAFILE,IDENTIFIED,TEMPFILE,TO,ONLINE,USER,NVARCHAR2,REFERENCES,
MODIFY,RENAME,DISABLE}
}
\pagestyle{fancyplain}
\lhead{Hamza ABBAD}
\chead{201200006342}
\rhead{SII M1 - Groupe 2}
\begin{document}
\maketitle
\begin{enumerate}
	\item Pour lister le catalogue \texttt{DICT} il suffit d'exécuter la requête suivante :
	\begin{lstlisting}[style=OracleSQL]
		SELECT * FROM DICT;
	\end{lstlisting}
	Elle retourne un grand nombre de lignes, dans mon cas, il a 1821 lignes. Il contient 2 colonnes :
	\begin{enumerate}
		\item \texttt{TABLE\_NAME} qui contient le nom de chaque table dans la méta-base.
		\item \texttt{COMMENTS} qui contient la description du contenu de cette table.
	\end{enumerate}
	\item La table \texttt{ALL\_TAB\_COLUMNS} décrit les colonnes des tables et vues accessibles à l'utilisateur courant, et
	comme cet utilisateur est \texttt{SYSTEM}, on voit tout les tables existantes.
	Ce tabeau contient 31 colonnes, parmi eux on trouve :
	\begin{itemize}
		\item \texttt{OWNER} : Le nom de l'utilisateur propriétaire de la table/vue.
		\item \texttt{TABLE\_NAME} : Le nom de la table/vue.
		\item \texttt{COLUMN\_NAME} : Le nom de la colonne.
		\item \texttt{DATA\_TYPE} : Le type de la colonne.
		\item \texttt{DATA\_LENGTH} : La taille de la colonne (en octets).
		\item \texttt{DATA\_PRECISION} : La précision d'un nombre décimal (Pour les types \texttt{FLOAT} et \texttt{NUMBER}).
		\item \texttt{NULLABLE} : Spécifie si la colonne accepte la valeur \texttt{NULL}. Si la valeur de cette colonne est \texttt{N}
		alors il n'est pas possible d'insérer \texttt{NULL} dans cette colonne.
		\item \texttt{COLUMN\_ID} : Un nombre unique identifiant la colonne.
		\item \texttt{DATA\_DEFAULT} : La valeur par défaut de la colonne.
		\item \texttt{NUM\_DISTINCT} : Nombre de valeurs distincts dans la colonne.
		\item \texttt{LOW\_VALUE} : La plus petite valeur dans la colonne.
		\item \texttt{HIGH\_VALUE} : La plus grande valeur dans la colonne.
		\item \texttt{NUM\_NULLS} : Nombre de valeurs \texttt{NULL} dans la colonne.
	\end{itemize}
	La table \texttt{USER\_USERS} décrit l'utilisateur courant. Il contient 10 colonnes :
	\begin{itemize}
		\item \texttt{USERNAME} : Le nom de l'utilisateur.
		\item \texttt{USER\_ID} : L'identificateur de l'utilisateur.
		\item \texttt{ACCOUNT\_STATUS} : L'état de son compte.
		\item \texttt{LOCK\_DATE} : Date de verrouillage du compte (S'il est verrouillé).
		\item \texttt{EXPIRY\_DATE} : Date de péremption du compte.
		\item \texttt{DEFAULT\_TABLESPACE} : L'espace des tables par défaut pour ce compte.
		\item \texttt{TEMPORARY\_TABLESPACE} : L'espace des tables temporaire pour ce compte.
		\item \texttt{CREATED} : La date de création du compte.
		\item \texttt{INITIAL\_RSRC\_CONSUMER\_GROUP}.
		\item \texttt{EXTERNAL\_NAME}.
	\end{itemize}
	La table \texttt{ALL\_CONSTRAINTS} décrit tout les contraintes d'integrité qui sont accessibles à l'utilisateur courant.
	Comme on est connecté avec \texttt{SYSTEM}, alors on peut voir tout les contraintes existantes.
	Cette table contient 21 colonnes, parmi ces colonnes on trouve :
	\begin{itemize}
		\item \texttt{OWNER} : Le nom de l'utilisateur propriétaire de la contrainte.
		\item \texttt{CONSTRAINT\_NAME} : Le nom de la contrainte.
		\item \texttt{CONSTRAINT\_TYPE} : Le type de la contrainte.
		\item \texttt{TABLE\_NAME} : La table/vue qui associé à la contrainte.
		\item \texttt{R\_OWNER} : Le nom de l'utilisateur propriétaire de la table référencée (Si la contrainte est référentielle).
		\item \texttt{R\_CONSTRAINT\_NAME} : Le nom de la contrainte dans la table référencée (Si la contrainte est référentielle).
		\item \texttt{DELETE\_RULE} : La règle de suppression pour les contraintes référentielles.
		\item \texttt{STATUS} : \'{E}tat d'activation de la contrainte.
		\item \texttt{LAST\_CHANGE} : La dernière date d'activation/désactivation de la contrainte.
	\end{itemize}
	La table \texttt{USER\_TAB\_PRIVS} décrit les privilèges des objets dont l'utilisateur courant il est le propriétaire,
	le concédent ou le titulaire du privilège. Il contient 7 colonnes :
	\begin{itemize}
		\item \texttt{GRANTEE} : Le nom de l'utilisateur dont le privilège est accordé.
		\item \texttt{OWNER} : Le nom de l'utilisateur propriétaire de l'objet.
		\item \texttt{TABLE\_NAME} : Le nom de l'objet.
		\item \texttt{GRANTOR} : Le nom de l'utilisateur qui a attribué le privilège.
		\item \texttt{PRIVILEGE} : Le nom du privilège.
		\item \texttt{GRANTABLE} : Indique si le privilege a été attribué en utilisant le \texttt{GRANT OPTION}.
		\item \texttt{HIERARCHY} : Indique si le privilege a été attribué en utilisant le \texttt{HIERARCHY OPTION}.
	\end{itemize}
	\item Pour trouver le nom de l'utilisateur courant, il suffit d'exécuter la requête suivante :
	\begin{lstlisting}[style=OracleSQL]
		SELECT USERNAME FROM USER_USERS;
	\end{lstlisting}
	Résultat : \texttt{SYS}.
	\item La différence entre les tables \texttt{ALL\_TAB\_COLUMNS} et \texttt{USER\_TAB\_COLUMNS} est que le premier contient
	les colonnes des tables que l'utilisateur courant a le privilège de les consulter, par contre le second ne contient que les
	colonnes des tables dont il est le propriétaire. C'est pour cela que la table \texttt{ALL\_TAB\_COLUMNS} contient une colonne
	supplémentaire \texttt{OWNER} indiquant le propriétaire de la table.
	\item On peut vérifier que les tables ont été créer en récupérant la colonne \texttt{TABLE\_NAME} de la table \texttt{ALL\_TABLES}
	ou \texttt{OWNER} égale au nom de l'utilisateur qui a créé la table.
	\begin{lstlisting}[style=OracleSQL]
		SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER = 'ABBAD';
	\end{lstlisting}
	Les autres colonnes de \texttt{ALL\_TABLES} donnent d'autres informations sur ces tables.
	\item Lister les tables de \texttt{SYSTEM} et \texttt{ADMINHOPITAL}:
	\begin{lstlisting}[style=OracleSQL]
		SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER = 'SYSTEM';
		SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER = 'ADMINHOPITAL';
	\end{lstlisting}
	Pour \texttt{SYSTEM} l'exécution a retourné 138 lignes, par contre pour \texttt{ADMINHOPITAL} aucune ligne n'est retournée, car
	il n'y a aucune table qui a été créé par cet utilisateur.
	\item Pour voir la description des attributs des tables \texttt{HOSPITALISATION} et \texttt{PATIENT} il suffit de connecter en tant
	que l'utilisateur propriétaire de ces tables et exécuter la requête suivante :
	\begin{lstlisting}[style=OracleSQL]
		SELECT COLUMN_NAME, DATA_TYPE, NULLABLE, DATA_DEFAULT FROM USER_TAB_COLUMNS WHERE TABLE_NAME IN ('HOSPITALISATION', 'PATIENT');
	\end{lstlisting}
	\item Pour vérifier qu'il y a une clé étrangère de \texttt{HOSPITALISATION} vers \texttt{PATIENT} on peut exécuter la requêtable
	suivante :
	\begin{lstlisting}[style=OracleSQL]
		SELECT A.TABLE_NAME, A.CONSTRAINT_NAME, B.TABLE_NAME FROM ALL_CONSTRAINTS A INNER JOIN ALL_CONSTRAINTS B ON A.R_CONSTRAINT_NAME
		= B.CONSTRAINT_NAME WHERE A.CONSTRAINT_TYPE = 'P' AND A.TABLE_NAME = 'HOSPITALISATION' AND B.TABLE_NAME = 'PATIENT';
	\end{lstlisting}
	Résultat :
	\begin{verbatim}
		TABLE_NAME            CONSTRAINT_NAME           TABLE_NAME
		------------------------------------------------------------------------
		HOSPITALISATION       FK_NUM_PATIENT            PATIENT
	\end{verbatim}
	Cette requête cherche les tables qui ont au moins une clé qui référence une autre table, ensuite elle vérifie si la clé est une
	clé étrangère et que le nom de la table source est \texttt{HOSPITALISATION} et la table destination est \texttt{PATIENT}.
	\item Pour obtenir la liste des contraintes créées lors du premier TP avec le type, le nom de la table, le nom de la contraine
	référencée (pour les clés étrangères) et l'état de chaque contrainte on exécute la requête suivante à partir de l'utilisateur
	qui a créé les tables :
	\begin{lstlisting}[style=OracleSQL]
		SELECT CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME, R_CONSTRAINT_NAME, DELETE_RULE, STATUS FROM USER_CONSTRAINTS;
	\end{lstlisting}
	\item Les informations qui permet de recréer la table \texttt{HOSPITALISATION} sont : les noms des colonnes, ses types, la taille
	de chaque type, peut être \texttt{NULL} ou non, les noms des contraintes, ses types et ses contraintes référencées. On peut
	récupérer ces données à l'aide de ces requêtes :
	\begin{lstlisting}[style=OracleSQL]
		SELECT COLUMN_NAME, DATA_TYPE, DATA_PRECISION, CHAR_LENGTH, NULLABLE FROM USER_TAB_COLUMNS WHERE TABLE_NAME = 'HOSPITALISATION';
		SELECT CONSTRAINT_NAME, CONSTRAINT_TYPE, R_CONSTRAINT_NAME, DELETE_RULE FROM USER_CONSTRAINTS WHERE TABLE_NAME = 'HOSPITALISATION';
	\end{lstlisting}
	\item Comme nous avons enlevé tout les privilèges accordés à \texttt{AdminHopital} dans le TP 2 et nous avons affecté quelque unes
	au rôle \texttt{GestionnairePatient} et \texttt{AdminHopital} est affecté a ce rôle donc les privilèges de cet utilisateur sont
	les mêmes que ce rôle, on peut les voir en exécutant cette requête :
	\begin{lstlisting}[style=OracleSQL]
		SELECT PRIVILEGE, TABLE_NAME FROM ALL_TAB_PRIVS WHERE GRANTEE = 'GESTIONNAIREPATIENT';
	\end{lstlisting}
	Résultats :
	\begin{verbatim}
		PRIVILEGE           TABLE_NAME
		-----------------------------------------
		SELECT              PATIENT
		UPDATE              HOSPITALISATION
		INSERT              HOSPITALISATION
		DELETE              HOSPITALISATION
		SELECT              SOIGNE
	\end{verbatim}
	\item Pour retrouver les rôles affectés à \texttt{AdminHopital} on exécute cette requête à partir de l'utilisateur
	\texttt{SYSTEM} :
	\begin{lstlisting}[style=OracleSQL]
		SELECT GRANTED_ROLE FROM DBA_ROLE_PRIVS WHERE GRANTEE = 'ADMINHOPITAL';
	\end{lstlisting}
	Résultats :
	\begin{verbatim}
		GRANTED_ROLE
		-------------------
		GESTIONNAIREPATIENT
	\end{verbatim}
	\item Pour retrouver tous les objets qui appartiennent à \texttt{AdminHopital} à partir de \texttt{SYSTEM} on doit
	exécuter la requête suivante :
	\begin{lstlisting}[style=OracleSQL]
		SELECT OBJECT_NAME FROM ALL_OBJECTS WHERE OWNER = 'ADMINHOPITAL';
	\end{lstlisting}
	Résultats :
	\begin{verbatim}
		OBJECT_NAME
		-------------------
		PATIENTMUTUELLE_IX
	\end{verbatim}
	\item Pour connaitre le propriétaire de la table \texttt{HOSPITALISATION} il doit simplement exécuter l'inverse de la
	requête précédente c'est à dire :
	\begin{lstlisting}[style=OracleSQL]
		SELECT OWNER FROM ALL_OBJECTS WHERE OBJECT_NAME = 'HOSPITALISATION';
	\end{lstlisting}
	Résultats :
	\begin{verbatim}
		OWNER
		-------------------
		ABBAD
	\end{verbatim}
\end{enumerate}
\end{document}
